# Автоматическое восстановление пропущенных ответов

## Как работает

### 1. Через webhook после деплоя:
- GitHub Actions вызывает endpoint `/webhook/deploy` с секретным ключом
- Endpoint проверяет секретный ключ
- Запускает метод `checkUncompletedTasks()`

### 2. Через ручную команду `/ans` (только для админа):
- Админ может вызвать проверку в любой момент
- Используется для экстренной проверки без деплоя

### Логика проверки:
1. Находит все незавершенные посты за последние 7 дней
2. Для каждого поста проверяет:
   - Писал ли пользователь после создания поста
   - Какой текущий шаг (на основе task1/2/3_completed)
   - Если пользователь уже ответил, но не получил следующее задание - автоматически отправляет

### Что отправляется:
- Если `task1_completed = 0` и пользователь писал → отправляет плюшки
- Если `task2_completed = 0` и пользователь писал → отправляет третье задание

### Куда отправляется:
- Используется `message_thread_id = channelMessageId` для отправки в правильный тред комментариев

## Преимущества решения:
1. **Полностью автоматическое** - пользователь ничего не должен делать
2. **Работает сразу после деплоя** - через 5 секунд после запуска
3. **Не спамит** - проверка только один раз при запуске
4. **Учитывает историю** - проверяет реальные сообщения пользователя

## Пример сценария:
1. Пользователь ответил на первое задание в 21:55
2. Бот упал/завис и не ответил
3. В 22:05 деплой новой версии
4. В 22:05:05 автоматическая проверка находит пропущенный ответ
5. Пользователь получает плюшки в комментарии к своему посту
6. Может продолжить выполнять задания как обычно