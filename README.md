# PSY Froggy Bot üê∏ [![Deploy to Digital Ocean](https://github.com/o-maan/psyfroggybot/actions/workflows/deploy.yml/badge.svg)](https://github.com/o-maan/psyfroggybot/actions/workflows/deploy.yml)

–ë–æ—Ç-–ª—è–≥—É—à–∫–∞ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏.

## –§—É–Ω–∫—Ü–∏–∏

- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ 22:00
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Calendar
- –£–ø—Ä–æ—â—ë–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –¥–Ω–µ–π —Å –ø–µ—Ä–µ–ª—ë—Ç–∞–º–∏
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ 1.5 —á–∞—Å–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—Ç–≤–µ—Ç–∞
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

```mermaid
graph TD
    A["üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"] --> B["üìö –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"]
    B --> C["üë• –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ë–î"]
    C --> D["üïê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è cron –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞"]
    D --> E["‚öôÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ cron job: 30 19 * * *"]
    E --> F["üåç –£—Å—Ç–∞–Ω–æ–≤–∫–∞ timezone: Europe/Moscow"]
    F --> G["‚úÖ Cron job –∞–∫—Ç–∏–≤–µ–Ω"]
    G --> H["‚è∞ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 22:00 –ú–°–ö"]
    H --> I["üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–≥–≥–µ—Ä"]
    I --> J["üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º"]
    J --> K["‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã"]
    K --> H

    L["üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start"] --> M["‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫"]
    M --> N["üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î"]

    O["üîß –ê–¥–º–∏–Ω: /status"] --> P["üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å cron job"]
    Q["üß™ –ê–¥–º–∏–Ω: /test_schedule"] --> R["‚è±Ô∏è –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π cron –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–∏–Ω—É—Ç—É"]

    S["üõë –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã"] --> T["‚è∞ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ cron job"]
    T --> U["üßπ –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤"]

    style A fill:#e1f5fe
    style I fill:#fff3e0
    style J fill:#e8f5e8
    style K fill:#e8f5e8
    style E fill:#f3e5f5
    style G fill:#e8f5e8
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Runtime**: Bun
- **Framework**: Telegraf (Telegram Bot API)
- **Database**: SQLite + Knex.js
- **AI**: Hugging Face Inference API
- **Calendar**: Google Calendar API
- **Web Server**: Caddy
- **Process Manager**: PM2
- **Notifications**: Telegram Bot API

## –î–µ–ø–ª–æ–π –Ω–∞ Digital Ocean

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –¥—Ä–æ–ø–ª–µ—Ç–∞

–°–æ–∑–¥–∞–π—Ç–µ Ubuntu 22.04 –¥—Ä–æ–ø–ª–µ—Ç –Ω–∞ Digital Ocean —Å –º–∏–Ω–∏–º—É–º 1GB RAM.

### 2. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
ssh root@your-server-ip

# –°–∫–∞—á–∞–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
curl -O https://raw.githubusercontent.com/o-maan/psy_froggy_bot/main/setup-server.sh
chmod +x setup-server.sh
./setup-server.sh
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/var/www/psy_froggy_bot/.env`:

```bash
nano /var/www/psyfroggybot/.env
```

–î–æ–±–∞–≤—å—Ç–µ:

```env
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
HF_TOKEN=your_hugging_face_token
ADMIN_CHAT_ID=your_admin_chat_id
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
NODE_ENV=production
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è GitHub –¥–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã:

- `DO_HOST`: IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- `DO_USERNAME`: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—ã—á–Ω–æ `root`)
- `DO_SSH_KEY`: –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
- `DO_PORT`: –ø–æ—Ä—Ç SSH (–æ–±—ã—á–Ω–æ `22`)
- `TELEGRAM_BOT_TOKEN`: —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞

–ù–∞–ø—Ä–∞–≤—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏ –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞:

```
A    psy_froggy_bot.invntrm.ru         -> your-server-ip
A    www.psy_froggy_bot.invntrm.ru     -> your-server-ip
```

### 6. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
cd /var/www/psy_froggy_bot
pm2 restart psy_froggy_bot
pm2 logs psy_froggy_bot
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –º–µ—Ä–∂–µ –≤ `main` –≤–µ—Ç–∫—É:

1. üì≤ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –¥–µ–ø–ª–æ—è –≤ Telegram –∫–∞–Ω–∞–ª
2. –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
4. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ PM2
5. Caddy –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
6. üì≤ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ –≤ Telegram –∫–∞–Ω–∞–ª

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
bun install

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
npx knex migrate:latest

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
bun src/bot.ts
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ
2. –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

   ```env
   TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
   HF_TOKEN=your_huggingface_api_key_here
   ```

3. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `images` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ—ë –∫–∞—Ä—Ç–∏–Ω–∫–∏ (jpg, png, jpeg)

## –ó–∞–ø—É—Å–∫

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 status
pm2 logs psy_froggy_bot
pm2 monit

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart psy_froggy_bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Caddy
sudo systemctl status caddy
sudo caddy validate --config /etc/caddy/Caddyfile

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -f /var/log/pm2/psy_froggy_bot.log
tail -f /var/log/caddy/psy_froggy_bot.log
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
- `messages` - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- `user_tokens` - —Ç–æ–∫–µ–Ω—ã Google Calendar
- `user_image_indexes` - –∏–Ω–¥–µ–∫—Å—ã –∫–∞—Ä—Ç–∏–Ω–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## API Endpoints

- `GET /status` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `POST /oauth2callback` - callback –¥–ª—è Google OAuth
- `POST /sendDailyMessage` - —Ä—É—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

- `/start` - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Å—ã–ª–∫–∏
- `/fro` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–µ–π—á–∞—Å
- `/calendar` - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ Google Calendar
- `/test` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `/remind` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)

- `/status` - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/test_schedule` - –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã
- `/next_image` - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/minimalTestLLM` - —Ç–µ—Å—Ç —Ä–∞–±–æ—Ç—ã —Å LLM

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ 22:00 –ú–°–ö** –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Å –ø–æ–º–æ—â—å—é cron job (`0 22 * * *`)
2. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
3. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π node-cron
4. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** —á–µ—Ä–µ–∑ 1.5 —á–∞—Å–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—Ç–≤–µ—Ç–∞
5. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç** —Å –ø–æ–º–æ—â—å—é –ò–ò –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ cron –Ω–∞–¥ setTimeout

- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å** - —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
- ‚úÖ **–ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ—Å–∫–æ–≤—Å–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ cron –≤—ã—Ä–∞–∂–µ–Ω–∏—è
