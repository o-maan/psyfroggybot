/**
 * Миграция: Исправление настроек Оли (476561547) для основного бота
 *
 * ПРОБЛЕМА:
 * Оля использует один chat_id в обоих ботах (тестовом и основном).
 * В продакшн БД хранятся настройки из тестового бота:
 *   dm_enabled=0, channel_enabled=1, channel_id=-1002846400650
 *
 * Когда Оля регистрируется в основном боте как "Чудо ✨",
 * бот находит СУЩЕСТВУЮЩУЮ запись и использует неправильные настройки.
 * Результат: посты НЕ приходят в ЛС.
 *
 * РЕШЕНИЕ:
 * Для обычных пользователей (не Алекс):
 *   dm_enabled=1, channel_enabled=0, channel_id=NULL
 *
 * ВАЖНО:
 * Эта миграция НЕ затронет тестовый бот, потому что:
 * - Тестовый бот использует ДРУГУЮ базу данных (локальную)
 * - Эта миграция применяется ТОЛЬКО к продакшн БД
 */

exports.up = async function(knex) {
  // Исправляем настройки для Оли (ID: 476561547) в основном боте
  await knex('users')
    .where('chat_id', 476561547)
    .update({
      dm_enabled: 1,
      channel_enabled: 0,
      channel_id: null
    });
};

exports.down = function(knex) {
  // Откат: возвращаем настройки тестового бота
  return knex('users')
    .where('chat_id', 476561547)
    .update({
      dm_enabled: 0,
      channel_enabled: 1,
      channel_id: -1002846400650
    });
};
