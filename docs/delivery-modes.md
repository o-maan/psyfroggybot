# –†–µ–∂–∏–º—ã –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (dm_enabled / channel_enabled)

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ñ–ª–∞–≥–æ–≤ `dm_enabled` –∏ `channel_enabled` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç–∞–≤–∫–æ–π –ø–æ—Å—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

- **–¶–µ–ª–µ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** (476561547, 5153477378): –ø–æ–ª—É—á–∞—é—Ç –ø–æ—Å—Ç—ã –≤ –∫–∞–Ω–∞–ª + –∫–æ–ø–∏—é –≤ –õ–°
- **–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –ø–æ–ª—É—á–∞—é—Ç –ø–æ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –≤ –õ–°

## üìä –§–ª–∞–≥–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ users

```sql
dm_enabled       boolean default '0'  -- –î–æ—Å—Ç–∞–≤–∫–∞ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (DM)
channel_enabled  boolean default '0'  -- –î–æ—Å—Ç–∞–≤–∫–∞ –≤ –∫–∞–Ω–∞–ª
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:

| dm_enabled | channel_enabled | –ü–æ–≤–µ–¥–µ–Ω–∏–µ |
|------------|----------------|-----------|
| `1` | `1` | –ü–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª + –∫–æ–ø–∏—è –≤ –õ–° + –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö |
| `1` | `0` | –ü–æ—Å—Ç —Ç–æ–ª—å–∫–æ –≤ –õ–° + –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –õ–° |
| `0` | `1` | –ü–æ—Å—Ç —Ç–æ–ª—å–∫–æ –≤ –∫–∞–Ω–∞–ª (–±–µ–∑ –õ–°) |
| `0` | `0` | –ù–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è |

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–∫–æ–º–∞–Ω–¥–∞ /start)

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ /start:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: `addUser(chatId, username)`
   - –í—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
     - `dm_enabled = 0`
     - `channel_enabled = 0`

2. **–í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –õ–°**: `enableDMMode(chatId)`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å: `UPDATE users SET dm_enabled = 1 WHERE chat_id = ?`

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç**:
   - `dm_enabled = 1` ‚úÖ
   - `channel_enabled = 0` ‚úÖ

### –ö–æ–¥ (src/commands/user/start.ts):

```typescript
// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏
scheduler.addUser(chatId);

// üÜï –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–õ–°) –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
enableDMMode(chatId);
botLogger.info({ userId, chatId }, '‚úÖ –†–µ–∂–∏–º –õ–° –≤–∫–ª—é—á–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
```

## ‚úÖ –î–ª—è —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∫–∞–Ω–∞–ª + –õ–°)

–¶–µ–ª–µ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–±–∞ —Ñ–ª–∞–≥–∞ –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏:

```sql
UPDATE users
SET dm_enabled = 1, channel_enabled = 1
WHERE chat_id IN (476561547, 5153477378);
```

## üìù –¢–∏–ø—ã –ø–æ—Å—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏

–í—Å–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã –ø–æ—Å—Ç–æ–≤ —É—á–∏—Ç—ã–≤–∞—é—Ç —Ñ–ª–∞–≥–∏ dm_enabled/channel_enabled:

### 1. –í–µ—á–µ—Ä–Ω–∏–π –ø–æ—Å—Ç (sendInteractiveDailyMessage)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ 22:00 MSK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ —á–µ—Ä–µ–∑ `/fro`
- –õ–æ–≥–∏–∫–∞: [scheduler.ts:1944-2275](../src/scheduler.ts#L1944-L2275)

### 2. –£—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Å—Ç (sendMorningMessage)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –≤–µ—á–µ—Ä–Ω–∏–π –ø–æ—Å—Ç
- –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞: `/test_morning`
- –õ–æ–≥–∏–∫–∞: [scheduler.ts:4132-4157](../src/scheduler.ts#L4132-L4157)

### 3. –ó–ª–æ–π –ø–æ—Å—Ç (sendAngryPost)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ 8:00 —É—Ç—Ä–∞ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤–µ—á–µ—Ä–Ω–∏–π –ø–æ—Å—Ç
- –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞: `/test_morning_check`
- –õ–æ–≥–∏–∫–∞: [scheduler.ts:3763-4097](../src/scheduler.ts#L3763-L4097)

### 4. JOY –ø–æ—Å—Ç (sendJoyPostWithWeeklySummary)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è–º –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ –≤–µ—á–µ—Ä–Ω–µ–≥–æ –ø–æ—Å—Ç–∞
- –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞: `/test_joy [userId]`
- –õ–æ–≥–∏–∫–∞: [scheduler.ts:7857-8106](../src/scheduler.ts#L7857-L8106)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã:

```bash
# –¢–µ—Å—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
bun test src/user-registration.test.ts

# –¢–µ—Å—Ç—ã —Ä–µ–∂–∏–º–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
bun test src/delivery-modes.test.ts
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# –í–µ—á–µ—Ä–Ω–∏–π –ø–æ—Å—Ç
/fro

# –£—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Å—Ç
/test_morning

# –ó–ª–æ–π –ø–æ—Å—Ç (morning check)
/test_morning_check

# JOY –ø–æ—Å—Ç
/test_joy 476561547    # –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/test_joy 999888777    # –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–æ–ª—å–∫–æ —Å –õ–°
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

- **476561547**: `dm_enabled=1, channel_enabled=1` (—Ü–µ–ª–µ–≤–æ–π #1)
- **5153477378**: `dm_enabled=1, channel_enabled=1` (—Ü–µ–ª–µ–≤–æ–π #2)
- **999888777**: `dm_enabled=1, channel_enabled=0` (—Ç–µ—Å—Ç–æ–≤—ã–π - —Ç–æ–ª—å–∫–æ –õ–°)

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–ª–∞–≥–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT chat_id, username, dm_enabled, channel_enabled, timezone
FROM users
WHERE chat_id = 476561547;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π
SELECT chat_id, username, dm_enabled, channel_enabled
FROM users
WHERE dm_enabled = 1 OR channel_enabled = 1;
```

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: –ü—Ä–∏ /start –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –≤–∫–ª—é—á–∞–µ—Ç—Å—è dm_enabled=1. –ù–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!

2. **–¶–µ–ª–µ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –¢–æ–ª—å–∫–æ –¥–ª—è 2 —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω—É–∂–Ω–æ –í–†–£–ß–ù–£–Æ –≤–∫–ª—é—á–∏—Ç—å channel_enabled=1

3. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**:
   - –î–ª—è –∫–∞–Ω–∞–ª–∞ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –≥—Ä—É–ø–ø—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
   - –î–ª—è –õ–° ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –ª–∏—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

4. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ï—Å–ª–∏ –æ–±–∞ —Ñ–ª–∞–≥–∞ –≤–∫–ª—é—á–µ–Ω—ã, –ø–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –í –ö–ê–ù–ê–õ, –∞ –∑–∞—Ç–µ–º –ö–û–ü–ò–Ø –≤ –õ–°

## üìã –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç /start
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ –ë–î
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è dm_enabled=1
- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –ø–æ—Å—Ç—ã –≤ –õ–°
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–ª—è —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å channel_enabled=1

## üîß –§—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–¥–µ

### –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –õ–°:
```typescript
import { enableDMMode } from './db';
enableDMMode(chatId);
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –õ–°:
```typescript
import { disableDMMode } from './db';
disableDMMode(chatId);
```

### –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∫–∞–Ω–∞–ª–∞:
```typescript
import { enableChannelMode } from './db';
enableChannelMode(chatId);
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∫–∞–Ω–∞–ª–∞:
```typescript
import { disableChannelMode } from './db';
disableChannelMode(chatId);
```
