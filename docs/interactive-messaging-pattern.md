# –ü–∞—Ç—Ç–µ—Ä–Ω –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

## –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø

–ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ –í–°–Ø —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —ç—Ç–æ–º—É –ø–æ—Å—Ç—É. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã!

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### 1. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞
```typescript
// –ü–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ:
const channelMessage = await bot.telegram.sendPhoto(CHANNEL_ID, imageBuffer, {
  caption: `${messageData.inspiring_text}\n\n–ü–µ—Ä–µ—Ö–æ–¥–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏–º üòâ`,
  reply_markup: {
    inline_keyboard: [[
      { text: 'üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏', url: `https://t.me/c/${CHAT_ID.toString().slice(4)}/${messageThreadId}` }
    ]]
  }
});
```

### 2. –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
```typescript
// –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
const firstMessage = await bot.telegram.sendMessage(
  CHAT_ID,  // ID –≥—Ä—É–ø–ø—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π
  '–¢–µ–∫—Å—Ç –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è',
  {
    message_thread_id: messageThreadId,  // –í–ê–ñ–ù–û: —É–∫–∞–∑—ã–≤–∞–µ–º thread –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ç–∫—É
    reply_markup: {
      inline_keyboard: [[
        { text: '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å', callback_data: `skip_task1_${channelMessageId}` }
      ]]
    }
  }
);
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ü–†–ê–í–ò–õ–¨–ù–´–ô –ø–∞—Ç—Ç–µ—Ä–Ω (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤):
```typescript
// –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
const replyToChatId = ctx.chat.id; // –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º —á–∞—Ç, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ

// –í –∫–ª–∞—Å—Å–µ-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ (DeepWorkHandler, SimplifiedHandler –∏ —Ç.–¥.)
class Handler {
  private chatId: number; // –°–æ—Ö—Ä–∞–Ω—è–µ–º replyToChatId –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
  
  constructor(bot: Telegraf, chatId: number) {
    this.bot = bot;
    this.chatId = chatId; // –≠—Ç–æ replyToChatId –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
  }
  
  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏
  private async sendMessage(text: string, replyToMessageId?: number, options = {}) {
    const sendOptions: any = {
      parse_mode: options.parse_mode || 'HTML',
      ...options
    };
    
    // –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢: –∏—Å–ø–æ–ª—å–∑—É–µ–º reply_parameters –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –≤ —Ç—Ä–µ–¥–µ
    if (replyToMessageId) {
      sendOptions.reply_parameters = {
        message_id: replyToMessageId
      };
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Ç–æ—Ç –∂–µ —á–∞—Ç, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
    return await this.bot.telegram.sendMessage(this.chatId, text, sendOptions);
  }
}
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫

```typescript
// –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∫–Ω–æ–ø–æ–∫
bot.action(/pattern/, async (ctx) => {
  const chatId = ctx.chat?.id;
  
  // –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º chatId
  const handler = new DeepWorkHandler(bot, chatId);
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∞–º –ø–æ–∑–∞–±–æ—Ç–∏—Ç—Å—è –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —á–∞—Ç
  await handler.handleButtonAction();
});
```

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
```typescript
// –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ message_thread_id –ø—Ä–∏ –æ—Ç–≤–µ—Ç–∞—Ö –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
await bot.telegram.sendMessage(chatId, text, {
  message_thread_id: threadId, // –≠–¢–û –í–´–ó–û–í–ï–¢ –û–®–ò–ë–ö–£!
  reply_parameters: { message_id: replyTo }
});

// –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ getChatId() –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
const handler = new Handler(bot, getChatId()); // –ù–ï–í–ï–†–ù–û!

// –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ reply_parameters –¥–ª—è sendPhoto!
await bot.telegram.sendPhoto(chatId, photo, {
  reply_parameters: { message_id: replyTo } // –§–û–¢–û –£–ô–î–ï–¢ –í –ì–†–£–ü–ü–£!
});
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
```typescript
// –î–ª—è —Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ reply_parameters
await bot.telegram.sendMessage(chatId, text, {
  reply_parameters: { message_id: replyTo }
});

// –î–ª—è —Ñ–æ—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ reply_to_message_id
await bot.telegram.sendPhoto(chatId, photo, {
  caption: text,
  reply_to_message_id: replyToMessageId // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!
});

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ chatId –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
const replyToChatId = ctx.chat.id;
const handler = new Handler(bot, replyToChatId); // –ü–†–ê–í–ò–õ–¨–ù–û!
```

### üì∏ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û –î–õ–Ø –§–û–¢–û
- **sendMessage** ‚Üí `reply_parameters`
- **sendPhoto** ‚Üí `reply_to_message_id`
- –≠—Ç–æ —Ä–∞–∑–Ω—ã–µ API! –ï—Å–ª–∏ –ø–µ—Ä–µ–ø—É—Ç–∞—Ç—å - —Ñ–æ—Ç–æ —É–π–¥–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≥—Ä—É–ø–ø—É –≤–º–µ—Å—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤!

## –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏–∞–ª–æ–≥–∞

1. **–ü–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª–µ** ‚Üí –∫–∞—Ä—Ç–∏–Ω–∫–∞ + —Ç–µ–∫—Å—Ç + "–ü–µ—Ä–µ—Ö–æ–¥–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏"
2. **–ü–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –∫–Ω–æ–ø–∫–æ–π –ø—Ä–æ–ø—É—Å–∫–∞
3. **–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** ‚Üí –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ** ‚Üí –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–∏–∞–ª–æ–≥, –æ—Ç–≤–µ—á–∞—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. **–ö–Ω–æ–ø–∫–∏** ‚Üí –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π

## –°–æ—Å—Ç–æ—è–Ω–∏—è –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
- `waiting_negative` ‚Üí –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤—ã–≥—Ä—É–∑–∫—É –Ω–µ–≥–∞—Ç–∏–≤–∞
- `waiting_positive` ‚Üí –∂–¥–µ–º –ø–ª—é—à–µ–∫
- `waiting_practice` ‚Üí –∂–¥–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∞–∫—Ç–∏–∫–∏

### –ì–ª—É–±–æ–∫–∞—è —Ä–∞–±–æ—Ç–∞:
- `deep_waiting_situation_choice` ‚Üí –≤—ã–±–æ—Ä —Å–∏—Ç—É–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞
- `deep_waiting_filters_start` ‚Üí –æ–∂–∏–¥–∞–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏—è "–ü–æ–≥–Ω–∞–ª–∏"
- `deep_waiting_thoughts` ‚Üí –∂–¥–µ–º –æ–ø–∏—Å–∞–Ω–∏—è –º—ã—Å–ª–µ–π
- `deep_waiting_distortions` ‚Üí –∂–¥–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Å–∫–∞–∂–µ–Ω–∏–π
- `deep_waiting_rational` ‚Üí –∂–¥–µ–º —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏

## Fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö LLM

–ï—Å–ª–∏ Hugging Face –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã:
- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Üí —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –∑–∞–¥–∞–Ω–∏–π
- –ì–ª—É–±–æ–∫–∞—è —Ä–∞–±–æ—Ç–∞ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ñ–∏–ª—å—Ç—Ä—ã –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è —Å fallback —Ç–µ–∫—Å—Ç–∞–º–∏

## –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

1. **src/scheduler.ts** - `handleInteractiveUserResponse()` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
2. **src/handlers/messages/text.ts** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
3. **src/handlers/callbacks/** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
4. **src/deep-work-handler.ts** - –ª–æ–≥–∏–∫–∞ –≥–ª—É–±–æ–∫–æ–π —Ä–∞–±–æ—Ç—ã
5. **src/db.ts** - —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –ø–æ—Å—Ç–æ–≤

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–æ—Å—Ç–∞ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
2. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (reply)
3. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–æ–∫ –æ—Ç–≤–µ—Ç –∏–¥–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
4. –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ "message thread not found"
5. –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ–ª–∂–Ω—ã —É—Ö–æ–¥–∏—Ç—å –≤ –ª–∏—á–∫—É –∏–ª–∏ –æ—Å–Ω–æ–≤–Ω—É—é –≥—Ä—É–ø–ø—É