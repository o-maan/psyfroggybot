# ะกะธััะตะผะฐ ะฐะดะฐะฟัะฐัะธะธ ัะตะบััะพะฒ ะฟะพะด ะฟะพะป ะฟะพะปัะทะพะฒะฐัะตะปั

## ๐ ะะฑะทะพั

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฐะดะฐะฟัะธััะตั ะฒัะต ัะตะบััะพะฒัะต ัะพะพะฑัะตะฝะธั ะฟะพะด ะฟะพะป ะฟะพะปัะทะพะฒะฐัะตะปั (ะผัะถัะบะพะน/ะถะตะฝัะบะธะน ัะพะด) ะธัะฟะพะปัะทัั ััััััะพะฒะฝะตะฒัั ะฐััะธัะตะบัััั ั ะฟัะธะพัะธัะตัะฐะผะธ.

**ะะปะฐะฒะฝะฐั ััะฝะบัะธั:** `sendToUser()` ะฒ [src/utils/send-to-user.ts](../src/utils/send-to-user.ts)

## ๐๏ธ ะััะธัะตะบัััะฐ (3 ััะพะฒะฝั)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1๏ธโฃ FIXED_TEXTS (21 ัะตะบัั)          โ  โ ะะฐัะฐะฝัะธัะพะฒะฐะฝะฝะฐั ะบะพััะตะบัะฝะพััั
โ    ะัะธะพัะธัะตั: ะะซะกะจะะ               โ     ะะณะฝะพะฒะตะฝะฝะฐั ะพัะฟัะฐะฒะบะฐ
โ    ะขะพัะฝะพััั: 100%                  โ     ะััะฝะฐั ะฟัะพะฒะตัะบะฐ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ (ะตัะปะธ ะฝะต ะฝะฐะนะดะตะฝะพ)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2๏ธโฃ LLM + ะะะจ (24 ัะฐัะฐ)             โ  โ ะฃะฝะธะฒะตััะฐะปัะฝะฐั ะฐะดะฐะฟัะฐัะธั
โ    ะัะธะพัะธัะตั: ะกะะะะะะ              โ     ะะฐะฑะพัะฐะตั ั ะะฎะะซะะ ัะตะบััะฐะผะธ
โ    ะขะพัะฝะพััั: 100% (ะฟัะพัะตััะธัะพะฒะฐะฝะพ) โ     ะะตัะฒัะน ะทะฐะฟัะพั: 6-22 ัะตะบ
โ    ะะพะดะตะปั: DeepSeek-R1-0528        โ     ะะพะฒัะพัะฝัะต: ะผะณะฝะพะฒะตะฝะฝะพ (ะบะตั)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ (ะตัะปะธ LLM failed)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3๏ธโฃ REGEX FALLBACK                  โ  โ ะะพะดัััะฐัะพะฒะบะฐ
โ    ะัะธะพัะธัะตั: ะะะะจะะ               โ     ะะณะฝะพะฒะตะฝะฝะฐั ะพัะฟัะฐะฒะบะฐ
โ    ะขะพัะฝะพััั: ~70-80%               โ     ะะฐะฑะพัะฐะตั ะพััะปะฐะนะฝ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## โ ะะปะฐะฒะฝะพะต ะฟัะตะธะผััะตััะฒะพ

**ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฝะพะฒะพะน ะปะพะณะธะบะธ/ัะตะบััะพะฒ ะฐะดะฐะฟัะฐัะธั ัะฐะฑะพัะฐะตั ะะะขะะะะขะะงะะกะะ ัะตัะตะท LLM!**
- โ ะะต ะฝัะถะฝะพ ะดะพะฟะธััะฒะฐัั ะฟัะฐะฒะธะปะฐ ะฒ regex
- โ ะะต ะฝัะถะฝะพ ะดะพะฑะฐะฒะปััั ัะตะบััั ะฒ FIXED_TEXTS
- โ ะะฐะฑะพัะฐะตั ัะฝะธะฒะตััะฐะปัะฝะพ ั ะปัะฑัะผะธ ะณะปะฐะณะพะปะฐะผะธ ะธ ะบะพะฝััััะบัะธัะผะธ

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### โ ะัะฐะฒะธะปัะฝะพ (ะะกะะะะ):

```typescript
import { sendToUser } from './utils/send-to-user';

// ะะปั ัะพะพะฑัะตะฝะธะน ะฟะพะปัะทะพะฒะฐัะตะปั
await sendToUser(bot, chatId, userId, 'ะขั ะพัะปะธัะฝะพ ัะฟัะฐะฒะธะปัั!', options);
// ะะตะฝัะธะฝะต: "ะขั ะพัะปะธัะฝะพ ัะฟัะฐะฒะธะปะฐัั!"
// ะัะถัะธะฝะต: "ะขั ะพัะปะธัะฝะพ ัะฟัะฐะฒะธะปัั!"

// ะะปั ัะธััะตะผะฝัั ัะพะพะฑัะตะฝะธะน (ะฑะตะท ะฐะดะฐะฟัะฐัะธะธ)
await sendToUser(bot, adminChatId, null, 'ะกะธััะตะผะฝะพะต ัะฒะตะดะพะผะปะตะฝะธะต', options);
```

### โ ะะตะฟัะฐะฒะธะปัะฝะพ (ะะะะะะะ):

```typescript
// ะะ ะธัะฟะพะปัะทัะน ะฝะฐะฟััะผัั!
await bot.telegram.sendMessage(chatId, 'ะขั ะพัะปะธัะฝะพ ัะฟัะฐะฒะธะปัั!', options);
// ะขะตะบัั ะะ ะฐะดะฐะฟัะธััะตััั ะฟะพะด ะฟะพะป
```

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

ะกะธััะตะผะฐ ะฟัะพัะตััะธัะพะฒะฐะฝะฐ ะฝะฐ 5 ัะปะพะถะฝัั ะบะตะนัะฐั ั ัะตะทัะปััะฐัะพะผ **100% ััะฟะตัะฐ**:

| ะขะตัั | ะัะธะณะธะฝะฐะป | ะะตะฝัะบะธะน ัะพะด | ะะตะทัะปััะฐั |
|------|----------|-------------|-----------|
| 1 | ะขั ะพัะปะธัะฝะพ ัะฟัะฐะฒะธะปัั ั ะทะฐะดะฐะฝะธะตะผ! ะฏ ะณะพัะถััั ัะพะฑะพะน | ะขั ะพัะปะธัะฝะพ ัะฟัะฐะฒะธะปะฐัั ั ะทะฐะดะฐะฝะธะตะผ! ะฏ ะณะพัะถััั ัะพะฑะพะน | โ |
| 2 | ะะพะปะพะดะตั, ัั ะฟัะพัะฒะธะป ะฝะฐััะพะนัะธะฒะพััั ะธ ะดะพััะธะณ ัะตะปะธ | ะะพะปะพะดะตั, ัั ะฟัะพัะฒะธะปะฐ ะฝะฐััะพะนัะธะฒะพััั ะธ ะดะพััะธะณะปะฐ ัะตะปะธ | โ |
| 3 | ะขั ะฑัะป ะพัะตะฝั ะฒะฝะธะผะฐัะตะปัะฝัะผ ัะตะณะพะดะฝั. ะัะพะดะพะปะถะฐะน ะฒ ัะพะผ ะถะต ะดััะต! | ะขั ะฑัะปะฐ ะพัะตะฝั ะฒะฝะธะผะฐัะตะปัะฝะพะน ัะตะณะพะดะฝั. ะัะพะดะพะปะถะฐะน ะฒ ัะพะผ ะถะต ะดััะต! | โ |
| 4 | ะะฐะบ ัั ัะตะฑั ััะฒััะฒะพะฒะฐะป ะฟะพัะปะต ะฟัะฐะบัะธะบะธ? | ะะฐะบ ัั ัะตะฑั ััะฒััะฒะพะฒะฐะปะฐ ะฟะพัะปะต ะฟัะฐะบัะธะบะธ? | โ |
| 5 | ะขั ะฟะพะบะฐะทะฐะป ะพัะปะธัะฝัะต ัะตะทัะปััะฐัั. ะฏ ัะฒะตัะตะฝ, ััะพ ั ัะตะฑั ะฒัะต ะฟะพะปััะธััั | ะขั ะฟะพะบะฐะทะฐะปะฐ ะพัะปะธัะฝัะต ัะตะทัะปััะฐัั. ะฏ ัะฒะตัะตะฝ, ััะพ ั ัะตะฑั ะฒัะต ะฟะพะปััะธััั | โ |

## ๐ฏ ะัะฐะฒะธะปะฐ LLM-ะฐะดะฐะฟัะฐัะธะธ

ะัะพะผะฟั ะดะปั LLM ัะพะดะตัะถะธั ัััะพะณะธะต ะฟัะฐะฒะธะปะฐ:

1. **ะะตะฝัะน ะขะะะฌะะ ะพะฑัะฐัะตะฝะธั ะบ ะฟะพะปัะทะพะฒะฐัะตะปั**: "ัั ัะดะตะปะฐะป" โ "ัั ัะดะตะปะฐะปะฐ"
2. **ะะ ะผะตะฝัะน ัะตัั ะปัะณััะบะธ-ะฟัะธัะพะปะพะณะฐ**: "ั ัะฐะด" โ "ั ัะฐะด" (ะะ "ั ัะฐะดะฐ")
3. **ะัะณััะบะฐ ะะกะะะะ ะผัะถัะบะพะณะพ ัะพะดะฐ**: "ั ัะฒะตัะตะฝ" โ "ั ัะฒะตัะตะฝ" (ะะ "ั ัะฒะตัะตะฝะฐ")
4. **ะะตะฝัะน ะณะปะฐะณะพะปั ะฟัะพัะตะดัะตะณะพ ะฒัะตะผะตะฝะธ**: -ะป/-ะฐะป/-ะธะป/-ะตะป โ -ะปะฐ/-ะฐะปะฐ/-ะธะปะฐ/-ะตะปะฐ
5. **ะะตะฝัะน ะบัะฐัะบะธะต ะฟัะธะปะฐะณะฐัะตะปัะฝัะต**: -ะตะฝ/-ะพะฝ โ -ะฝะฐ
6. **ะะพะทะฒัะฐัะฐะน ะขะะะฌะะ ัะตะบัั**: ะฑะตะท ะฟะพััะฝะตะฝะธะน ะธ ะบะฐะฒััะตะบ

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะัะตะผั ะพัะฟัะฐะฒะบะธ:

- **FIXED_TEXTS**: < 1 ms (ะผะณะฝะพะฒะตะฝะฝะพ)
- **LLM (ะฟะตัะฒัะน ัะฐะท)**: 6-22 ัะตะบัะฝะดั (ะทะฐะฒะธัะธั ะพั ัะตะบััะฐ)
- **LLM (ะธะท ะบะตัะฐ)**: < 1 ms (ะผะณะฝะพะฒะตะฝะฝะพ)
- **Regex fallback**: < 1 ms (ะผะณะฝะพะฒะตะฝะฝะพ)

### ะะตัะธัะพะฒะฐะฝะธะต:

- **TTL (ะฒัะตะผั ะถะธะทะฝะธ)**: 24 ัะฐัะฐ
- **ะคะพัะผะฐั ะบะปััะฐ**: `female_[ัะตะบัั]`
- **ะฅัะฐะฝะธะปะธัะต**: in-memory Map (ะพัะธัะฐะตััั ะฟัะธ ัะตััะฐััะต ะฑะพัะฐ)

## ๐๏ธ FIXED_TEXTS ัะปะพะฒะฐัั

21 ะบัะธัะธัะฝัะน ัะตะบัั ั ะณะพัะพะฒัะผะธ ะฐะดะฐะฟัะฐัะธัะผะธ:

- โ ะะฐะฟะพะผะธะฝะฐะฝะธั (ะฒะตัะตัะฝะธะต, ะฝะตะทะฐะฒะตััะตะฝะฝัะต, ะฟัะฐะบัะธะบะฐ)
- โ ะะฝะพะฟะบะธ ะธ ะบะพัะพัะบะธะต ัะพะพะฑัะตะฝะธั
- โ Deep work ะฟะพะทะดัะฐะฒะปะตะฝะธั
- โ ะะฝะฑะพัะดะธะฝะณ
- โ Practice completed (10 ะฒะฐัะธะฐะฝัะพะฒ)
- โ JOY ะปะพะณะธะบะฐ

## ๐ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

### ะัะปะธ LLM ะฝะตะดะพัััะฟะตะฝ:

1. LLM API timeout โ ะธัะฟะพะปัะทัะตััั regex fallback
2. LLM ะฒะตัะฝัะป ะพัะธะฑะบั โ ะธัะฟะพะปัะทัะตััั regex fallback
3. LLM ะฒะตัะฝัะป ะฟะพะดะพะทัะธัะตะปัะฝัะน ัะตะทัะปััะฐั โ ะธัะฟะพะปัะทัะตััั regex fallback

### ะะพะณะธัะพะฒะฐะฝะธะต:

```typescript
botLogger.debug('ะัะฟะพะปัะทะพะฒะฐะฝ ะณะพัะพะฒัะน ัะตะบัั ะธะท FIXED_TEXTS');
botLogger.debug('ะัะฟะพะปัะทะพะฒะฐะฝ ะบะตัะธัะพะฒะฐะฝะฝัะน ัะตะบัั ะธะท LLM');
botLogger.debug('ะขะตะบัั ะฐะดะฐะฟัะธัะพะฒะฐะฝ ัะตัะตะท LLM ะธ ะทะฐะบะตัะธัะพะฒะฐะฝ');
botLogger.warn('LLM ะฝะต ััะฐะฑะพัะฐะป, ะธัะฟะพะปัะทะพะฒะฐะฝ regex fallback');
```

## ๐ ะกะฒัะทะฐะฝะฝัะต ัะฐะนะปั

- **ะัะฝะพะฒะฝะพะน ะผะพะดัะปั**: [src/utils/send-to-user.ts](../src/utils/send-to-user.ts)
- **Regex fallback**: [src/utils/gender-adapter.ts](../src/utils/gender-adapter.ts)
- **LLM ัะตัะฒะธั**: [src/llm.ts](../src/llm.ts)
- **ะัะธััะบะฐ LLM**: [src/utils/clean-llm-text.ts](../src/utils/clean-llm-text.ts)

## ๐ ะััะพัะธั

- **ะะพ 2025-12-05**: ะขะพะปัะบะพ regex-ะฐะดะฐะฟัะฐัะธั (~70-80% ัะพัะฝะพััั, ััะตะฑัะตั ัััะฝัั ะฟัะฐะฒะธะป)
- **ะะพัะปะต 2025-12-05**: ะขัััััะพะฒะฝะตะฒะฐั ัะธััะตะผะฐ ั LLM (100% ัะพัะฝะพััั, ัะฝะธะฒะตััะฐะปัะฝะฐั)

## โ๏ธ ะะฐะถะฝัะต ะทะฐะผะตัะฐะฝะธั

1. **ะะกะะะะ** ะธัะฟะพะปัะทัะน `sendToUser()` ะฒะผะตััะพ ะฟััะผัั `bot.telegram.sendMessage()`
2. **ะะ ะะะะซะะะ** ะฟะตัะตะดะฐะฒะฐัั `userId` ะดะปั ะฐะดะฐะฟัะฐัะธะธ ะฟะพะด ะฟะพะป
3. **ะะปั ัะธััะตะผะฝัั ัะพะพะฑัะตะฝะธะน** ะฟะตัะตะดะฐะฒะฐะน `null` ะฒะผะตััะพ `userId`
4. **ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฝะพะฒะพะน ะปะพะณะธะบะธ** ะฝะต ััะตะฑัะตััั ะดะพะฟะธััะฒะฐัั ะฟัะฐะฒะธะปะฐ - LLM ะฐะดะฐะฟัะธััะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ!

## ๐ค ะะบะปะฐะด

ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฝะพะฒัั ัะตะบััะพะฒ:

1. **ะัะธัะธัะฝัะต ัะตะบััั** (ะฝะฐะฟะพะผะธะฝะฐะฝะธั, ะพะฝะฑะพัะดะธะฝะณ) โ ะดะพะฑะฐะฒั ะฒ `FIXED_TEXTS`
2. **ะะฑััะฝัะต ัะตะบััั** โ ะฝะธัะตะณะพ ะฝะต ะดะตะปะฐะน, LLM ะฐะดะฐะฟัะธััะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ
3. **ะขะตััะธัะพะฒะฐะฝะธะต** โ ะพัะฟัะฐะฒั ัะตััะพะฒะพะต ัะพะพะฑัะตะฝะธะต ะถะตะฝัะธะฝะต-ะฟะพะปัะทะพะฒะฐัะตะปั

---

๐ ะกะพะทะดะฐะฝะพ ะดะปั PsyFroggyBot - ะฟัะธัะพะปะพะณะธัะตัะบะพะณะพ Telegram-ะฑะพัะฐ
